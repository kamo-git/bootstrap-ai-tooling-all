# プロジェクトコンテキスト（加美電機 / LAMP前提）
この文書は、AIコード生成ツール／AIレビューツールが本リポジトリで作業する際の最優先前提である。

## 1. 組織・業務コンテキスト
- 加美電機は日本の中小製造業（SME）。
- 主領域：電子回路基板の製造・実装・検査（AOI/ICT等）・不具合解析・品質対応。
- 多品種少量・例外対応が多く、「現場判断」「過去事例」が重要。

## 2. 運用環境（前提）
- 既存の LAMP 環境がある：Linux + Apache + MySQL/MariaDB + PHP。
- 既存資産と共存しつつ、段階的に改善する。大規模な刷新は前提にしない。

## 3. 開発・保守の現実
- 保守者はWeb専業とは限らない。
- 可読性・デバッグ容易性・修正可能性を最優先。
- 「動くが理解不能」「抽象化しすぎ」「依存追加が多い」実装は避ける。

## 4. フレームワーク / ORM / SQL の方針
- フレームワークは使用可。ただし「導入理由」が明確で、保守性が上がる場合に限る。
- ORMは状況次第：
  - CRUD中心で意図が明瞭になるならORM可。
  - JOIN/集計/複雑条件が絡むなら、SQLの方が明確ならSQL優先。
- ORM使用時も、クエリ意図が追える（必要なら想定SQL形をコメント）こと。

## 5. コード生成の必須ルール
- シンプルで直線的な処理構造（過剰設計しない）。
- 例外・入力揺れ・運用上の失敗を想定した堅牢性（エラーハンドリング、ログ、バリデーション）。
- 「今日のLAMP環境で動く」ことを優先し、追加基盤を要求しない。

## 6. レビュー（PRレビュー/自動レビュー）方針
- 最優先：正しさ、データ整合性、セキュリティ、運用リスク、性能劣化リスク。
- 形式・好みの指摘（bikeshedding）は、実害がある場合のみ。
- 大規模アーキテクチャ変更の提案は、明示依頼がない限り避ける。

## 7. 期待する出力スタイル
- 変更は段階的に。導入手順・影響範囲・ロールバック観点を簡潔に示す。
- 「なぜこの実装か」を短く説明する（コメントまたは本文）。

## 8. コメントとドキュメント更新（義務）
- コメントは「できるだけ残す」ことを義務とする。
  - 「何をしているか」ではなく「なぜそうするか」「業務上の意味」「前提」「例外条件」を優先して書く。
  - 不具合対応・例外対応・客先ルール・暫定処置は必ず理由と背景をコメントに残す。
- コード実装時は、必ずドキュメントも更新することを義務とする。
  - 仕様・運用・手順・設定・API・DB変更など、変更点を文書化する。
  - 更新先が不明な場合は、最低限 docs/ 配下に変更概要を追記する。
  - PRでは「更新したドキュメント」または「更新不要の理由」を必ず明記する。

## 9. テストの義務
- コード修正・新規実装後は、必ずテストを実施することを義務とする。
  - テストなしでのコミット・PR作成は禁止。
  - 最低限、動作確認（手動テスト）を実施し、主要な経路・例外ケースを確認する。
  - 可能な限り、自動テスト（ユニットテスト・統合テスト）を追加または更新する。
  - テスト実施内容（何をどう確認したか）は、PR説明またはコミットメッセージに明記する。
- テスト省略が許されるケース：
  - ドキュメントのみの変更（コード影響なし）。
  - 軽微な修正で影響範囲が明白かつ限定的な場合（理由を明記すること）。
- テストが困難な場合は、代替確認手段（ログ確認、手動検証手順など）を明示する。
